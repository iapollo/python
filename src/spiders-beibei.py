# -*-coding:utf-8-*-import urllib2import urllibimport jsonimport timeimport randomimport sys'''crawler function'''def crawler_beibei(password, username):    # headers    user_agent = 'BranchWork/3.6.3 (iPhone; iOS 8.3; Scale/3.00)'    content_type = 'application/x-www-form-urlencoded'    accept = '*/*'    accept_encoding = 'gzip, deflate'    connection = 'keep-alive'    host = 'api.zhibugongzuo.com'    accept_language = 'zh-Hans-CN;q=1, en-CN;q=0.9'    headers = {        # 'Accept'       : accept,        'User-Agent'   : user_agent,        'Content-Type' : content_type,        # 'Accept-Encoding' : accept_encoding,        'Connection'   : connection,        'Host'         : host,        'Accept-Language' : accept_language,        'header_version':'3.6.3'    }    ## 1 login    url = "https://api.zhibugongzuo.com/v3_1/Login"    values = {}    values['password'] = password    values['username'] = username    data = urllib.urlencode(values)    request = urllib2.Request(url, data, headers)    response = urllib2.urlopen(request)    hjson = json.loads(response.read())    ## 2 userinfo    url = "https://api.zhibugongzuo.com/v3_1/User/UserInfo"    values = {}    values['token'] = hjson['token']    data = urllib.urlencode(values)    request = urllib2.Request(url, data, headers)    response = urllib2.urlopen(request)    ## 3 device insert    url = "http://api.zhibugongzuo.com/v3_1/Device/Insert"    values = {}    values['device_id'] = "037F1741-79C1-4527-9427-93E96D6A2077"    values['os_system'] = "iOS"    values['os_version'] = "8.3"    values['token'] = hjson['token']    values['type'] = 2    data = urllib.urlencode(values)    request = urllib2.Request(url, data, headers)    response = urllib2.urlopen(request)    ## app page    url = "http://api.zhibugongzuo.com/v3_1/App/Page"    values = {}    values['token'] = hjson['token']    request = urllib2.Request(url, data, headers)    response = urllib2.urlopen(request)    ## app news    url = "https://api.zhibugongzuo.com/v3_1/App/News"    request = urllib2.Request(url, data, headers)    response = urllib2.urlopen(request)    ## news list    url = "https://api.zhibugongzuo.com/v3_1/News/List"    values = {}    values['page_index'] = "1"    values['page_size'] = "20"    values['token'] = hjson['token']    values['type'] = "2"    data = urllib.urlencode(values)    request = urllib2.Request(url, data, headers)    response = urllib2.urlopen(request)    hjson1  = json.loads(response.read())    # 点击新闻并发表评论    news_cmt_list = ['改革，是永远不变对法宝', '跟进落实党的一贯政策！', '共同建设富强民主对新时代', '国家越来越富强，人民越来越富有', '祖国加油！', '振奋人心！！', '我们要把这样的精神贯彻落实到日常工作中！', '学习了！', '赞！', '关注！']    for id in range(10):        url = "https://api.zhibugongzuo.com/v3_1/News/Detail"        values = {}        values['id'] = hjson1['data'][id]['id']        values['token'] = hjson['token']        data = urllib.urlencode(values)        request = urllib2.Request(url, data, headers)        response = urllib2.urlopen(request)        # news cmtlist        url = "https://api.zhibugongzuo.com/v3_1/News/CmtList"        values = {}        values['id'] = hjson1['data'][id]['id']        values['page_index'] = "1"        values['page_size'] = "10"        values['token'] = hjson['token']        values['type'] = "1"        data = urllib.urlencode(values)        request = urllib2.Request(url, data, headers)        response = urllib2.urlopen(request)        # news affix        url = "https://api.zhibugongzuo.com/v3_1/News/NewsAffix"        values = {}        values['nid'] = hjson1['data'][id]['id']        values['token'] = hjson['token']        data = urllib.urlencode(values)        request = urllib2.Request(url, data, headers)        response = urllib2.urlopen(request)        # comment news        url = "https://api.zhibugongzuo.com/v3_1/News/CommentNews"        values = {}        values['comment'] = news_cmt_list[id]        values['id'] = hjson1['data'][id]['id']        values['re_uid'] = ""        values['rid'] = ""        values['token'] = hjson['token']        data = urllib.urlencode(values)        request = urllib2.Request(url, data, headers)        response = urllib2.urlopen(request)        news_cmt_response = json.loads(response.read())        print "新闻评论！返回码：",news_cmt_response['code'].encode("utf-8"),\              "提示信息：" , news_cmt_response['msg'].encode("utf-8")        time.sleep(30)    # # 点击学习并发表评论（超过100字可以获得满分）    # # app study    # url = "https://api.zhibugongzuo.com/v3_1/App/Study"    # values = {}    # values['token'] = hjson['token']    # data = urllib.urlencode(values)    # request = urllib2.Request(url, data, headers)    # response = urllib2.urlopen(request)    # # materialtypelist    # url = "https://api.zhibugongzuo.com/v3_1/Study/MaterialTypeList"    # values = {}    # values['token'] = hjson['token']    # data = urllib.urlencode(values)    # request = urllib2.Request(url, data, headers)    # response = urllib2.urlopen(request)    # hjson2 = json.loads(response.read())    # typeid = hjson2['data'][0]['type']    # # material list    # url = "https://api.zhibugongzuo.com/v3_1/Study/MaterialList"    # values = {}    # values['page_index'] = "1"    # values['page_size'] = "20"    # values['token'] = hjson['token']    # values['type_id'] = typeid    # data = urllib.urlencode(values)    # request = urllib2.Request(url, data, headers)    # response = urllib2.urlopen(request)    # hjson3 = json.loads(response.read())    # mid = hjson3['data'][1]['id']    # name = hjson3['data'][0]['name']    #    # # record feeling    # url = "https://api.zhibugongzuo.com/v3_1/Study/RecordFeeling"    # values = {}    # values['content'] = "经过长期努力，中国特色社会主义进入了新时代。新时代要有新气象，更要有新作为。中共十九大到二十大的5年，正处在实现“两个一百年”奋斗目标的历史交汇期，第一个百年目标要实现，第二个百年奋斗目标要开篇。这其中有一些重要的时间节点，是我们工作的坐标"    # values['mid'] = mid    # values['token'] = hjson['token']    # data = urllib.urlencode(values)    # request = urllib2.Request(url, data, headers)    # response = urllib2.urlopen(request)    # study_material_response = json.loads(response.read())    # if study_material_response['code'] != 200 :    #     print "学习资料写体会错误！，提示信息：", study_material_response['msg'].encode("utf-8")    # # read time    # url = "https://api.zhibugongzuo.com/v3_1/Study/ReadTime"    # values = {}    # values['mid'] = mid    # values['time'] = random.randint(310, 400)    # values['token'] = hjson['token']    # data = urllib.urlencode(values)    # request = urllib2.Request(url, data, headers)    # response = urllib2.urlopen(request)    # 互动    # app inter    url = "https://api.zhibugongzuo.com/v3_1/App/Inter"    values = {}    values['token'] = hjson['token']    data = urllib.urlencode(values)    request = urllib2.Request(url, data, headers)    response = urllib2.urlopen(request)    # 互动广场:对两个问题进行回答，一个1分，2分满分    # help typelist    url = "https://api.zhibugongzuo.com/v3_1/Help/TypeList"    values = {}    values['token'] = hjson['token']    data = urllib.urlencode(values)    request = urllib2.Request(url, data, headers)    response = urllib2.urlopen(request)    # help list    url = 'https://api.zhibugongzuo.com/v3_1/Help/List'    values = {}    values['token'] = hjson['token']    values['page_size'] = 20    values['page_index'] = 1    values['type'] = 0    data = urllib.urlencode(values)    request = urllib2.Request(url, data, headers)    response = urllib2.urlopen(request)    help_list = json.loads(response.read())    for i in range(2):        # help detail        url = 'https://api.zhibugongzuo.com/v3_1/Help/Detail'        values = {}        values['token'] = hjson['token']        help_id = help_list['data'][random.randint(0, 19)]['id']        values['id'] = help_id        data = urllib.urlencode(values)        request = urllib2.Request(url, data, headers)        response = urllib2.urlopen(request)        # help getmorecmt        url = 'https://api.zhibugongzuo.com/v3_1/Help/GetMoreCmt'        values = {}        values['token'] = hjson['token']        values['id'] = help_id        values['page_size'] = 10        values['page_index'] = 1        values['type'] = 2        data = urllib.urlencode(values)        request = urllib2.Request(url, data, headers)        response = urllib2.urlopen(request)        help_cmt = json.loads(response.read())        # help postcomment        url = 'https://api.zhibugongzuo.com/v3_1/Help/PostComment'        values = {}        values['token'] = hjson['token']        values['id'] = help_id        values['re_uid'] = ''        values['rid'] = ''        help_cmt_len = len(help_cmt['data'])        values['content'] = help_cmt['data'][random.randint(0, help_cmt_len - 1)]['comment'].encode("utf-8")        data = urllib.urlencode(values)        request = urllib2.Request(url, data, headers)        response = urllib2.urlopen(request)        time.sleep(5)    # 党员视角:发布信息 一条信息2分，4分满分    # moments momentstype    url = "https://api.zhibugongzuo.com/v3_1/Moments/MomentsType"    values = {}    values['token'] = hjson['token']    data = urllib.urlencode(values)    request = urllib2.Request(url, data, headers)    response = urllib2.urlopen(request)    # moments commentnoread    url = "https://api.zhibugongzuo.com/v3_1/Moments/CommentNoread"    values = {}    values['token'] = hjson['token']    data = urllib.urlencode(values)    request = urllib2.Request(url, data, headers)    response = urllib2.urlopen(request)    for i in range(2):        # moment list        url = "https://api.zhibugongzuo.com/v3_1/Moments/List"        values = {}        values['page_size'] = 10        values['token'] = hjson['token']        data = urllib.urlencode(values)        request = urllib2.Request(url, data, headers)        response = urllib2.urlopen(request)        response_json = json.loads(response.read())        comment_content = response_json['data'][4]['content']        u = comment_content.encode("utf-8")        # prepare beforecreate        url = "https://api.zhibugongzuo.com/v3_1/Prepare/BeforeCreate"        values = {}        values['token'] = hjson['token']        values['type'] = 2        data = urllib.urlencode(values)        request = urllib2.Request(url, data, headers)        response = urllib2.urlopen(request)        # moments create        url = "https://api.zhibugongzuo.com/v3_1/Moments/Create"        values = {}        values['token'] = hjson['token']        values['type'] = ''        values['anon'] = 0        values['content'] = u        values['img'] = ''        values['img_type'] = ''        values['latitude'] = ''        values['limit_view'] = 1        values['location'] = ""        values['tags'] = 9        values['video'] = ""        values['video_thumb'] = ""        data = urllib.urlencode(values)        request = urllib2.Request(url, data, headers)        response = urllib2.urlopen(request)        comment_response = json.loads(response.read())        print "发布第", i + 1, "条信息！返回码：",comment_response['code'].encode("utf-8"),\              "提示信息：",comment_response['msg']        time.sleep(3)    # 学习5分钟，全5分    # app study    url = "https://api.zhibugongzuo.com/v3_1/App/study"    values = {}    values['token'] = hjson['token']    data = urllib.urlencode(values)    request = urllib2.Request(url, data, headers)    response = urllib2.urlopen(request)    # study materialtypelist    url = "https://api.zhibugongzuo.com/v3_1/study/materialtypelist"    values = {}    values['token'] = hjson['token']    data = urllib.urlencode(values)    request = urllib2.Request(url, data, headers)    response = urllib2.urlopen(request)    material_typeid = json.loads(response.read())    # study materiallist    url = "https://api.zhibugongzuo.com/v3_1/study/materiallist"    values = {}    values['token'] = hjson['token']    values['page_index'] = 1    values['page_size'] = 20    values['type_id'] = material_typeid['data'][random.randint(0,3)]['type']    data = urllib.urlencode(values)    request = urllib2.Request(url, data, headers)    response = urllib2.urlopen(request)    material_id = json.loads(response.read())    mid = material_id['data'][random.randint(0,19)]['id']    # study getfeelingsnum    url = "https://api.zhibugongzuo.com/v3_1/study/getfeelingsnum"    values = {}    values['token'] = hjson['token']    values['mid'] = mid    data = urllib.urlencode(values)    request = urllib2.Request(url, data, headers)    response = urllib2.urlopen(request)    # login checktoken    url = "https://api.zhibugongzuo.com/v3_1/login/checktoken"    values = {}    values['token'] = hjson['token']    data = urllib.urlencode(values)    request = urllib2.Request(url, data, headers)    response = urllib2.urlopen(request)    # study checkcollstatus    url = "https://api.zhibugongzuo.com/v3_1/study/checkcollstatus"    values = {}    values['token'] = hjson['token']    values['mid'] = mid    data = urllib.urlencode(values)    request = urllib2.Request(url, data, headers)    response = urllib2.urlopen(request)    time.sleep(10)    # user noread    url = "https://api.zhibugongzuo.com/v3_1/user/noread"    values = {}    values['token'] = hjson['token']    data = urllib.urlencode(values)    request = urllib2.Request(url, data, headers)    response = urllib2.urlopen(request)    time.sleep(10)    # record feeling    url = "https://api.zhibugongzuo.com/v3_1/Study/RecordFeeling"    values = {}    values['content'] = "经过长期努力，中国特色社会主义进入了新时代。新时代要有新气象，更要有新作为。中共十九大到二十大的5年，正处在实现“两个一百年”奋斗目标的历史交汇期，第一个百年目标要实现，第二个百年奋斗目标要开篇。这其中有一些重要的时间节点，是我们工作的坐标"    values['mid'] = mid    values['token'] = hjson['token']    data = urllib.urlencode(values)    request = urllib2.Request(url, data, headers)    response = urllib2.urlopen(request)    study_material_response = json.loads(response.read())    print "学习资料写体会！返回码：",study_material_response['code'].encode("utf-8"),\          "提示信息：", study_material_response['msg'].encode("utf-8")    time.sleep(10)    # study readtime    url = "https://api.zhibugongzuo.com/v3_1/study/readtime"    values = {}    values['token'] = hjson['token']    values['mid'] = mid    values['time'] = random.randint(100, 312)    data = urllib.urlencode(values)    request = urllib2.Request(url, data, headers)    response = urllib2.urlopen(request)    study_time = json.loads(response.read())    print "学习时间满5分钟！返回码：",study_time['code'].encode("utf-8"),\          "提示信息：", study_time['msg'].encode("utf-8")    returndict_user_info = {"zhangailing001":123456, "zhaoroujia":123456, "chengchengmumu":123456, "songxiaoxiao":"mt4426801219", "panwenzheng":123456789}print "running ",sys.argv[0]print "this time ,we handle", len(dict_user_info), "users"for key in dict_user_info:    print key    print dict_user_info[key]    crawler_beibei(dict_user_info[key], key)    time.sleep(10)